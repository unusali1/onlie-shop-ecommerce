{"ast":null,"code":"import _regeneratorRuntime from\"E:/Ecommerce/ecomern-frontend-main/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"E:/Ecommerce/ecomern-frontend-main/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"E:/Ecommerce/ecomern-frontend-main/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{CardElement,useElements,useStripe}from\"@stripe/react-stripe-js\";import React,{useState}from\"react\";import{Alert,Button,Col,Form,Row}from\"react-bootstrap\";import{useSelector}from\"react-redux\";import{useNavigate}from\"react-router-dom\";import{useCreateOrderMutation}from\"../services/appApi\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function CheckoutForm(){var stripe=useStripe();var elements=useElements();var user=useSelector(function(state){return state.user;});var navigate=useNavigate();var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),alertMessage=_useState2[0],setAlertMessage=_useState2[1];var _useCreateOrderMutati=useCreateOrderMutation(),_useCreateOrderMutati2=_slicedToArray(_useCreateOrderMutati,2),createOrder=_useCreateOrderMutati2[0],_useCreateOrderMutati3=_useCreateOrderMutati2[1],isLoading=_useCreateOrderMutati3.isLoading,isError=_useCreateOrderMutati3.isError,isSuccess=_useCreateOrderMutati3.isSuccess;var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),country=_useState4[0],setCountry=_useState4[1];var _useState5=useState(\"\"),_useState6=_slicedToArray(_useState5,2),address=_useState6[0],setAddress=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),paying=_useState8[0],setPaying=_useState8[1];function handlePay(_x){return _handlePay.apply(this,arguments);}function _handlePay(){_handlePay=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(e){var _yield$fetch$then,client_secret,_yield$stripe$confirm,paymentIntent;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:e.preventDefault();if(!(!stripe||!elements||user.cart.count<=0)){_context.next=3;break;}return _context.abrupt(\"return\");case 3:setPaying(true);_context.next=6;return fetch(\"https://online-shop-backend-h65l.onrender.com/create-payment\",{method:\"POST\",headers:{\"Content-Type\":\"application/json\",Authorization:\"Bearer \"},body:JSON.stringify({amount:user.cart.total})}).then(function(res){return res.json();});case 6:_yield$fetch$then=_context.sent;client_secret=_yield$fetch$then.client_secret;_context.next=10;return stripe.confirmCardPayment(client_secret,{payment_method:{card:elements.getElement(CardElement)}});case 10:_yield$stripe$confirm=_context.sent;paymentIntent=_yield$stripe$confirm.paymentIntent;setPaying(false);if(paymentIntent){createOrder({userId:user._id,cart:user.cart,address:address,country:country}).then(function(res){if(!isLoading&&!isError){setAlertMessage(\"Payment \".concat(paymentIntent.status));setTimeout(function(){navigate(\"/orders\");},2000);}});}case 14:case\"end\":return _context.stop();}}},_callee);}));return _handlePay.apply(this,arguments);}return/*#__PURE__*/_jsx(Col,{className:\"cart-payment-container\",children:/*#__PURE__*/_jsxs(Form,{onSubmit:handlePay,children:[/*#__PURE__*/_jsxs(Row,{children:[alertMessage&&/*#__PURE__*/_jsx(Alert,{children:alertMessage}),/*#__PURE__*/_jsx(Col,{md:6,children:/*#__PURE__*/_jsxs(Form.Group,{className:\"mb-3\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"First Name\"}),/*#__PURE__*/_jsx(Form.Control,{type:\"text\",placeholder:\"First Name\",value:user.name,disabled:true})]})}),/*#__PURE__*/_jsx(Col,{md:6,children:/*#__PURE__*/_jsxs(Form.Group,{className:\"mb-3\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Email\"}),/*#__PURE__*/_jsx(Form.Control,{type:\"text\",placeholder:\"Email\",value:user.email,disabled:true})]})})]}),/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{md:7,children:/*#__PURE__*/_jsxs(Form.Group,{className:\"mb-3\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Address\"}),/*#__PURE__*/_jsx(Form.Control,{type:\"text\",placeholder:\"Your Address\",value:address,onChange:function onChange(e){return setAddress(e.target.value);},required:true})]})}),/*#__PURE__*/_jsx(Col,{md:5,children:/*#__PURE__*/_jsxs(Form.Group,{className:\"mb-3\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Distict\"}),/*#__PURE__*/_jsx(Form.Control,{type:\"text\",placeholder:\"Your Distict\",value:country,onChange:function onChange(e){return setCountry(e.target.value);},required:true})]})})]}),/*#__PURE__*/_jsx(\"label\",{htmlFor:\"card-element\",children:\"Card\"}),/*#__PURE__*/_jsx(CardElement,{id:\"card-element\"}),/*#__PURE__*/_jsx(Button,{className:\"mt-3\",type:\"submit\",disabled:user.cart.count<=0||paying||isSuccess,children:paying?\"Processing...\":\"Pay\"})]})});}export default CheckoutForm;","map":{"version":3,"names":["CardElement","useElements","useStripe","React","useState","Alert","Button","Col","Form","Row","useSelector","useNavigate","useCreateOrderMutation","CheckoutForm","stripe","elements","user","state","navigate","alertMessage","setAlertMessage","createOrder","isLoading","isError","isSuccess","country","setCountry","address","setAddress","paying","setPaying","handlePay","e","preventDefault","cart","count","fetch","method","headers","Authorization","body","JSON","stringify","amount","total","then","res","json","client_secret","confirmCardPayment","payment_method","card","getElement","paymentIntent","userId","_id","status","setTimeout","name","email","target","value"],"sources":["E:/Ecommerce/ecomern-frontend-main/src/components/CheckoutForm.js"],"sourcesContent":["import { CardElement, useElements, useStripe } from \"@stripe/react-stripe-js\";\nimport React, { useState } from \"react\";\nimport { Alert, Button, Col, Form, Row } from \"react-bootstrap\";\nimport { useSelector } from \"react-redux\";\nimport { useNavigate } from \"react-router-dom\";\nimport { useCreateOrderMutation } from \"../services/appApi\";\n\nfunction CheckoutForm() {\n    const stripe = useStripe();\n    const elements = useElements();\n    const user = useSelector((state) => state.user);\n    const navigate = useNavigate();\n    const [alertMessage, setAlertMessage] = useState(\"\");\n    const [createOrder, { isLoading, isError, isSuccess }] = useCreateOrderMutation();\n    const [country, setCountry] = useState(\"\");\n    const [address, setAddress] = useState(\"\");\n    const [paying, setPaying] = useState(false);\n\n    async function handlePay(e) {\n        e.preventDefault();\n        if (!stripe || !elements || user.cart.count <= 0) return;\n        setPaying(true);\n        const { client_secret } = await fetch(\"https://online-shop-backend-h65l.onrender.com/create-payment\", {\n            method: \"POST\",\n            headers: {\n                \"Content-Type\": \"application/json\",\n                Authorization: \"Bearer \",\n            },\n            body: JSON.stringify({ amount: user.cart.total }),\n        }).then((res) => res.json());\n        const { paymentIntent } = await stripe.confirmCardPayment(client_secret, {\n            payment_method: {\n                card: elements.getElement(CardElement),\n            },\n        });\n        setPaying(false);\n\n        if (paymentIntent) {\n            createOrder({ userId: user._id, cart: user.cart, address, country }).then((res) => {\n                if (!isLoading && !isError) {\n                    setAlertMessage(`Payment ${paymentIntent.status}`);\n                    setTimeout(() => {\n                        navigate(\"/orders\");\n                    }, 2000);\n                }\n            });\n        }\n    }\n\n    return (\n        <Col className=\"cart-payment-container\">\n            <Form onSubmit={handlePay}>\n                <Row>\n                    {alertMessage && <Alert>{alertMessage}</Alert>}\n                    <Col md={6}>\n                        <Form.Group className=\"mb-3\">\n                            <Form.Label>First Name</Form.Label>\n                            <Form.Control type=\"text\" placeholder=\"First Name\" value={user.name} disabled />\n                        </Form.Group>\n                    </Col>\n                    <Col md={6}>\n                        <Form.Group className=\"mb-3\">\n                            <Form.Label>Email</Form.Label>\n                            <Form.Control type=\"text\" placeholder=\"Email\" value={user.email} disabled />\n                        </Form.Group>\n                    </Col>\n                </Row>\n                <Row>\n                    <Col md={7}>\n                        <Form.Group className=\"mb-3\">\n                            <Form.Label>Address</Form.Label>\n                            <Form.Control type=\"text\" placeholder=\"Your Address\" value={address} onChange={(e) => setAddress(e.target.value)} required />\n                        </Form.Group>\n                    </Col>\n                    <Col md={5}>\n                        <Form.Group className=\"mb-3\">\n                            <Form.Label>Distict</Form.Label>\n                            <Form.Control type=\"text\" placeholder=\"Your Distict\" value={country} onChange={(e) => setCountry(e.target.value)} required />\n                        </Form.Group>\n                    </Col>\n                </Row>\n                <label htmlFor=\"card-element\">Card</label>\n                <CardElement id=\"card-element\" />\n                <Button className=\"mt-3\" type=\"submit\" disabled={user.cart.count <= 0 || paying || isSuccess}>\n                    {paying ? \"Processing...\" : \"Pay\"}\n                </Button>\n            </Form>\n        </Col>\n    );\n}\n\nexport default CheckoutForm;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}